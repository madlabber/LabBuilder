---
- name: parse variables
  include_tasks: parse_vars.yml

- name: remove vm if state is absent or forced
  include_tasks: "{{host_type}}/absent.yml"

- name: upload install iso
  include_tasks: "{{host_type}}/upload_install_iso.yml"

- name: download tools 
  include_tasks: download_tools.yml 

- name: create config file
  include_tasks: "create_config_file.yml"

- name: create config iso
  include_tasks: "create_config_iso.yml"

- name: upload config iso
  include_tasks: "{{host_type}}/upload_config_iso.yml"

- name: build VM
  include_tasks: "{{host_type}}/build_vm.yml"

- name: join domain
  include_tasks: "{{host_type}}/join_domain.yml"
  when: join_domain|default(false)

- name: reboot guest
  include_tasks: "{{host_type}}/reboot_guest.yml"

- name: dcpromo
  include_tasks: "{{host_type}}/dcpromo.yml"
  when: dcpromo|default(false)

- name: Run extra commands
  include_tasks: "{{host_type}}/run_extra_commands.yml"

- name: clean up staging files
  include_tasks: cleanup.yml