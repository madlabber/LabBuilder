<?xml version="1.0" encoding="utf-8"?>
<unattend xmlns="urn:schemas-microsoft-com:unattend">
<settings pass="windowsPE">
<component name="Microsoft-Windows-International-Core-WinPE" processorArchitecture="amd64" publicKeyToken="31bf3856ad364e35" language="neutral" versionScope="nonSxS" xmlns:wcm="http://schemas.microsoft.com/WMIConfig/2002/State" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
<SetupUILanguage>
<UILanguage>en-US</UILanguage>
</SetupUILanguage>
<InputLocale>0c09:00000409</InputLocale>
<SystemLocale>en-US</SystemLocale>
<UILanguage>en-US</UILanguage>
<UILanguageFallback>en-US</UILanguageFallback>
<UserLocale>en-US</UserLocale>
</component>
<component name="Microsoft-Windows-Setup" processorArchitecture="amd64" publicKeyToken="31bf3856ad364e35" language="neutral" versionScope="nonSxS" xmlns:wcm="http://schemas.microsoft.com/WMIConfig/2002/State" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">

<UserData>
<AcceptEula>true</AcceptEula>
<FullName>Administrator</FullName>
<Organization>Organization</Organization>
</UserData>
<EnableFirewall>false</EnableFirewall>

<DiskConfiguration>

  <Disk wcm:action="add">
  <DiskID>0</DiskID>
  <WillWipeDisk>true</WillWipeDisk>
  <CreatePartitions>
    <!-- System partition -->
    <CreatePartition wcm:action="add">
      <Order>1</Order>
      <Type>Primary</Type>
      <Size>350</Size>
    </CreatePartition>

    <!-- Windows partition -->
    <CreatePartition wcm:action="add">
      <Order>2</Order>
      <Type>Primary</Type>
      <Extend>true</Extend>
    </CreatePartition>
  </CreatePartitions>

<ModifyPartitions>
      <!-- System partition -->
      <ModifyPartition wcm:action="add">
        <Order>1</Order>
        <PartitionID>1</PartitionID>
        <Label>System</Label>
        <TypeID>0x27</TypeID>
        <Format>NTFS</Format>
      </ModifyPartition>

      <!-- Windows partition -->
      <ModifyPartition wcm:action="add">
        <Order>2</Order>
        <PartitionID>2</PartitionID>
        <Label>Windows</Label>
        <Letter>C</Letter>
        <Format>NTFS</Format>
      </ModifyPartition>
    </ModifyPartitions>
  </Disk>
</DiskConfiguration>

<ImageInstall>
<OSImage>

    <!-- Target Partition -->
<InstallTo>
<DiskID>0</DiskID>
<PartitionID>2</PartitionID>
</InstallTo>

    <!-- Install Source -->
	<InstallFrom>
      <MetaData wcm:action="add">
        <Key>/IMAGE/NAME</Key>
        <Value>{{ image_name }}</Value>
      </MetaData>
	</InstallFrom>
</OSImage>
</ImageInstall>

</component>
</settings>
<settings pass="offlineServicing">
<component name="Microsoft-Windows-LUA-Settings" processorArchitecture="amd64" publicKeyToken="31bf3856ad364e35" language="neutral" versionScope="nonSxS" xmlns:wcm="http://schemas.microsoft.com/WMIConfig/2002/State" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
<EnableLUA>false</EnableLUA>
</component>
</settings>
<settings pass="generalize">
<component name="Microsoft-Windows-Security-SPP" processorArchitecture="amd64" publicKeyToken="31bf3856ad364e35" language="neutral" versionScope="nonSxS" xmlns:wcm="http://schemas.microsoft.com/WMIConfig/2002/State" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
<SkipRearm>1</SkipRearm>
</component>
</settings>
<settings pass="specialize">
<component name="Microsoft-Windows-International-Core" processorArchitecture="amd64" publicKeyToken="31bf3856ad364e35" language="neutral" versionScope="nonSxS" xmlns:wcm="http://schemas.microsoft.com/WMIConfig/2002/State" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
<InputLocale>0409:00000409</InputLocale>
<SystemLocale>en-US</SystemLocale>
<UILanguage>en-US</UILanguage>
<UILanguageFallback>en-US</UILanguageFallback>
<UserLocale>en-US</UserLocale>
</component>
<component name="Microsoft-Windows-Security-SPP-UX" processorArchitecture="amd64" publicKeyToken="31bf3856ad364e35" language="neutral" versionScope="nonSxS" xmlns:wcm="http://schemas.microsoft.com/WMIConfig/2002/State" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
<SkipAutoActivation>true</SkipAutoActivation>
</component>
<component name="Microsoft-Windows-SQMApi" processorArchitecture="amd64" publicKeyToken="31bf3856ad364e35" language="neutral" versionScope="nonSxS" xmlns:wcm="http://schemas.microsoft.com/WMIConfig/2002/State" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
<CEIPEnabled>0</CEIPEnabled>
</component>
<component name="Microsoft-Windows-Shell-Setup" processorArchitecture="amd64" publicKeyToken="31bf3856ad364e35" language="neutral" versionScope="nonSxS" xmlns:wcm="http://schemas.microsoft.com/WMIConfig/2002/State" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
<ComputerName>{{ vm_hostname|upper|truncate( 15, true, "", 0) }}</ComputerName>
</component>
  <component name="Microsoft-Windows-TerminalServices-LocalSessionManager" processorArchitecture="amd64" publicKeyToken="31bf3856ad364e35" language="neutral" versionScope="nonSxS" xmlns:wcm="http://schemas.microsoft.com/WMIConfig/2002/State" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <fDenyTSConnections>false</fDenyTSConnections>
  </component>
  <component name="Microsoft-Windows-TerminalServices-RDP-WinStationExtensions" processorArchitecture="amd64" publicKeyToken="31bf3856ad364e35" language="neutral" versionScope="nonSxS" xmlns:wcm="http://schemas.microsoft.com/WMIConfig/2002/State" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <UserAuthentication>0</UserAuthentication>
  </component>
  <component name="Networking-MPSSVC-Svc" processorArchitecture="amd64" publicKeyToken="31bf3856ad364e35" language="neutral" versionScope="nonSxS" xmlns:wcm="http://schemas.microsoft.com/WMIConfig/2002/State" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <FirewallGroups>
      <FirewallGroup wcm:action="add" wcm:keyValue="rd1">
        <Active>true</Active>
        <Group>Remote Desktop</Group>
        <Profile>all</Profile>
      </FirewallGroup>
    </FirewallGroups>
  </component>
</settings>
<settings pass="oobeSystem">
<component name="Microsoft-Windows-Shell-Setup" processorArchitecture="amd64" publicKeyToken="31bf3856ad364e35" language="neutral" versionScope="nonSxS" xmlns:wcm="http://schemas.microsoft.com/WMIConfig/2002/State" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
<AutoLogon>
<Password>
<Value>{{ vm_password }}</Value>
<PlainText>true</PlainText>
</Password>
<Enabled>true</Enabled>
<Username>Administrator</Username>
	<LogonCount>1</LogonCount>
</AutoLogon>
<FirstLogonCommands>
    <SynchronousCommand wcm:action="add">
    <Order>1</Order>
    <CommandLine>{{ first_logon_commands[0]|default('') }}</CommandLine>
    </SynchronousCommand>              
    <SynchronousCommand wcm:action="add">
    <Order>2</Order>
    <CommandLine>{{ first_logon_commands[1]|default('') }}</CommandLine>
    </SynchronousCommand>
    <SynchronousCommand wcm:action="add">
    <Order>3</Order>
    <CommandLine>{{ first_logon_commands[2]|default('') }}</CommandLine>
    </SynchronousCommand>
    <SynchronousCommand wcm:action="add">
    <Order>4</Order>
    <CommandLine>{{ first_logon_commands[3]|default('') }}</CommandLine>
    </SynchronousCommand>
    <SynchronousCommand wcm:action="add">
    <Order>5</Order>
    <CommandLine>{{ first_logon_commands[4]|default('') }}</CommandLine>
    </SynchronousCommand>
    <SynchronousCommand wcm:action="add">
    <Order>6</Order>
    <CommandLine>{{ first_logon_commands[5]|default('') }}</CommandLine>
    </SynchronousCommand>
    <SynchronousCommand wcm:action="add">
    <Order>7</Order>
    <CommandLine>{{ first_logon_commands[6]|default('') }}</CommandLine>
    </SynchronousCommand>
    <SynchronousCommand wcm:action="add">
    <Order>8</Order>
    <CommandLine>{{ first_logon_commands[7]|default('') }}</CommandLine>
    </SynchronousCommand>
    <SynchronousCommand wcm:action="add">
    <Order>9</Order>
    <CommandLine>{{ first_logon_commands[8]|default('') }}</CommandLine>
    </SynchronousCommand>
    <SynchronousCommand wcm:action="add">
    <Order>10</Order>
    <CommandLine>{{ first_logon_commands[9]|default('') }}</CommandLine>
    </SynchronousCommand>
    <SynchronousCommand wcm:action="add">
    <Order>11</Order>
    <CommandLine>netsh interface ipv4 set address "Local Area Connection" static {{ vm_address }} {{vm_netmask}} {{ vm_gateway }} 1</CommandLine>
    </SynchronousCommand>
    <SynchronousCommand wcm:action="add">
    <Order>12</Order>
    <CommandLine>netsh interface ipv4 set dns "Local Area Connection" static {{ vm_dns_server }}</CommandLine>
    </SynchronousCommand>
</FirstLogonCommands>
<OOBE>
    <HideEULAPage>true</HideEULAPage>
    <HideWirelessSetupInOOBE>true</HideWirelessSetupInOOBE>
    <NetworkLocation>Work</NetworkLocation>
    <ProtectYourPC>1</ProtectYourPC>
    <SkipMachineOOBE>true</SkipMachineOOBE>
    <SkipUserOOBE>true</SkipUserOOBE>
</OOBE>
<UserAccounts>
<AdministratorPassword>
<Value>{{ vm_password }}</Value>
<PlainText>true</PlainText>
</AdministratorPassword>
<LocalAccounts>
<LocalAccount wcm:action="add">
<Description>Administrator</Description>
<DisplayName>Administrator</DisplayName>
<Group>Administrators</Group>
<Name>Administrator</Name>
</LocalAccount>
</LocalAccounts>
</UserAccounts>
<RegisteredOrganization>Organization</RegisteredOrganization>
<RegisteredOwner>Administrator</RegisteredOwner>
<DisableAutoDaylightTimeSet>false</DisableAutoDaylightTimeSet>
<TimeZone>Pacific Standard Time</TimeZone>
</component>
</settings>
</unattend>
